{"version":3,"file":"component-portal.directive.js","sourceRoot":"ng://@codethatstack/portals/","sources":["lib/component-portal.directive.ts"],"names":[],"mappings":";AAAA,OAAO,EAAE,SAAS,EAAE,KAAK,EAAE,gBAAgB,EAAE,SAAS,EAAE,aAAa,EAAE,YAAY,EAAE,MAAM,EAAE,YAAY,EAAE,SAAS,EAAE,MAAM,eAAe,CAAC;AAC5I,OAAO,EAAE,OAAO,EAAgB,MAAM,MAAM,CAAC;AAC7C,OAAO,EAAE,GAAG,EAAE,SAAS,EAAE,MAAM,gBAAgB,CAAC;AAChD,OAAO,EAAE,aAAa,EAAE,MAAM,kBAAkB,CAAC;AAMjD,IAAa,wBAAwB,GAArC,MAAa,wBAAwB;IAcnC,YACU,aAA4B,EAC5B,gBAAkC;QADlC,kBAAa,GAAb,aAAa,CAAe;QAC5B,qBAAgB,GAAhB,gBAAgB,CAAkB;QAbpC,kBAAa,GAAG,IAAI,OAAO,EAAU,CAAC;QAQpC,cAAS,GAAG,IAAI,YAAY,EAAqB,CAAC;QAClD,gBAAW,GAAG,IAAI,YAAY,EAAqB,CAAC;QAM5D,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC,aAAa;aAClC,IAAI,CACH,GAAG,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC,gBAAgB,EAAE,CAAC,EAClC,SAAS,CAAC,WAAW,CAAC,EAAE;YACtB,OAAO,IAAI,CAAC,aAAa,CAAC,eAAe,CAAC;gBACxC,WAAW;gBACX,gBAAgB;gBAChB,QAAQ,EAAE,IAAI,CAAC,QAAQ;gBACvB,OAAO,EAAE,IAAI,CAAC,OAAO;gBACrB,OAAO,EAAE,IAAI,CAAC,OAAO;aACtB,CAAC,CAAC;QACL,CAAC,CAAC,CACH;aACA,SAAS,CAAC,YAAY,CAAC,EAAE;YACxB,IAAI,CAAC,aAAa,GAAG,YAAY,CAAC;YAClC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;YACxC,IAAI,CAAC,aAAa,CAAC,iBAAiB,CAAC,YAAY,EAAE,CAAC;QACtD,CAAC,CAAC,CAAC;IACT,CAAC;IAED,WAAW,CAAC,OAAsB;QAChC,IAAI,OAAO,CAAC,WAAW,IAAI,IAAI,EAAE;YAC/B,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,OAAO,CAAC,WAAW,CAAC,YAAY,CAAC,CAAC;SAC3D;IACH,CAAC;IAED,WAAW;QACT,IAAI,CAAC,aAAa,CAAC,WAAW,EAAE,CAAC;QACjC,IAAI,CAAC,gBAAgB,EAAE,CAAC;IAC1B,CAAC;IAEO,gBAAgB;QACtB,IAAI,IAAI,CAAC,aAAa,EAAE;YACtB,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;YAC1C,IAAI,CAAC,gBAAgB,CAAC,KAAK,EAAE,CAAC;YAC9B,IAAI,CAAC,aAAa,CAAC,OAAO,EAAE,CAAC;YAC7B,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC;SAC3B;IACH,CAAC;CAEF,CAAA;;YA3C0B,aAAa;YACV,gBAAgB;;AAVf;IAA5B,KAAK,CAAC,oBAAoB,CAAC;;6DAAqB;AACZ;IAApC,KAAK,CAAC,4BAA4B,CAAC;;0DAAkB;AAClB;IAAnC,KAAK,CAAC,2BAA2B,CAAC;;yDAAc;AACb;IAAnC,KAAK,CAAC,2BAA2B,CAAC;;yDAAkB;AAE3C;IAAT,MAAM,EAAE;;2DAAmD;AAClD;IAAT,MAAM,EAAE;;6DAAqD;AAZnD,wBAAwB;IAJpC,SAAS,CAAC;QACT,QAAQ,EAAE,sBAAsB;QAChC,QAAQ,EAAE,oBAAoB;KAC/B,CAAC;qCAgByB,aAAa;QACV,gBAAgB;GAhBjC,wBAAwB,CA0DpC;SA1DY,wBAAwB","sourcesContent":["import { Directive, Input, ViewContainerRef, OnChanges, SimpleChanges, ComponentRef, Output, EventEmitter, OnDestroy } from '@angular/core';\r\nimport { Subject, Subscription } from 'rxjs';\r\nimport { tap, switchMap } from 'rxjs/operators';\r\nimport { PortalService } from './portal.service';\r\n\r\n@Directive({\r\n  selector: '[ctsComponentPortal]',\r\n  exportAs: 'ctsComponentPortal'\r\n})\r\nexport class ComponentPortalDirective implements OnChanges, OnDestroy {\r\n\r\n  private _componentRef: ComponentRef<any>;\r\n  private _componentId$ = new Subject<string>();\r\n  private _subscription: Subscription;\r\n\r\n  @Input('ctsComponentPortal') componentId: string;\r\n  @Input('ctsComponentPortalAttachTo') attachTo: string;\r\n  @Input('ctsComponentPortalContext') context: any;\r\n  @Input('ctsComponentPortalContent') content: any[][];\r\n\r\n  @Output() activated = new EventEmitter<ComponentRef<any>>();\r\n  @Output() deactivated = new EventEmitter<ComponentRef<any>>();\r\n\r\n  constructor(\r\n    private portalService: PortalService,\r\n    private viewContainerRef: ViewContainerRef) {\r\n\r\n    this._subscription = this._componentId$\r\n        .pipe(\r\n          tap(() => this.destroyComponent()),\r\n          switchMap(componentId => {\r\n            return this.portalService.createComponent({\r\n              componentId,\r\n              viewContainerRef,\r\n              outletId: this.attachTo,\r\n              context: this.context,\r\n              content: this.content\r\n            });\r\n          })\r\n        )\r\n        .subscribe(componentRef => {\r\n          this._componentRef = componentRef;\r\n          this.activated.emit(this._componentRef);\r\n          this._componentRef.changeDetectorRef.markForCheck();\r\n        });\r\n  }\r\n\r\n  ngOnChanges(changes: SimpleChanges): void {\r\n    if (changes.componentId != null) {\r\n      this._componentId$.next(changes.componentId.currentValue);\r\n    }\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this._subscription.unsubscribe();\r\n    this.destroyComponent();\r\n  }\r\n\r\n  private destroyComponent(): void {\r\n    if (this._componentRef) {\r\n      this.deactivated.emit(this._componentRef);\r\n      this.viewContainerRef.clear();\r\n      this._componentRef.destroy();\r\n      this._componentRef = null;\r\n    }\r\n  }\r\n\r\n}"]}